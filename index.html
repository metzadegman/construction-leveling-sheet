<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

  const SUPABASE_URL = "https://rplmmwtlusqrbuzdanxx.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwbG1td3RsdXNxcmJ1emRhbnh4Iiwicm9zZSI6ImFub24iLCJpYXQiOjE3NjMwNzA1MjMsImV4cCI6MjA3ODY0NjUyM30.GI9tq-ItRpJyDEyj2OUQeefGSkIk0_1-ofIm1b3fGrc";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  const el = (id) => document.getElementById(id);

  async function uploadTakeoff() {
    try {
      const file = el("pdfFile").files[0];
      if (!file) {
        el("uploadStatus").innerHTML = "<span style='color:red'>Choose a PDF first.</span>";
        return;
      }

      el("uploadStatus").innerText = "Uploadingâ€¦";

      const fileName = `${Date.now()}_${file.name.replace(/\s+/g, "_")}`;

      const { error } = await supabase.storage
        .from("takeoffs")
        .upload(fileName, file, {
          contentType: "application/pdf",
        });

      if (error) throw error;

      el("uploadStatus").innerHTML = `<span style='color:green'>Uploaded: ${fileName}</span>`;
    } catch (err) {
      console.error(err);
      el("uploadStatus").innerHTML = "<span style='color:red'>Error uploading file.</span>";
    }
  }

  document.addEventListener("click", (e) => {
    if (e.target.id === "uploadPdf") uploadTakeoff();
  });
</script>
